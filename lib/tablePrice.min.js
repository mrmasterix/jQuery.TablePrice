/* jQuery.tablePrice v1.0.0 */ 
;(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(jQuery)}})(function(e){function n(e){return u.raw?e:encodeURIComponent(e)}function r(e){return u.raw?e:decodeURIComponent(e)}function i(e){return n(u.json?JSON.stringify(e):String(e))}function s(e){if(e.indexOf('"')===0){e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{e=decodeURIComponent(e.replace(t," "))}catch(n){return}try{return u.json?JSON.parse(e):e}catch(n){}}function o(t,n){var r=u.raw?t:s(t);return e.isFunction(n)?n(r):r}var t=/\+/g;var u=e.cookie=function(t,s,a){if(s!==undefined&&!e.isFunction(s)){a=e.extend({},u.defaults,a);if(typeof a.expires==="number"){var f=a.expires,l=a.expires=new Date;l.setDate(l.getDate()+f)}return document.cookie=[n(t),"=",i(s),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}var c=t?undefined:{};var h=document.cookie?document.cookie.split("; "):[];for(var p=0,d=h.length;p<d;p++){var v=h[p].split("=");var m=r(v.shift());var g=v.join("=");if(t&&t===m){c=o(g,s);break}if(!t&&(g=o(g))!==undefined){c[m]=g}}return c};u.defaults={};e.removeCookie=function(t,n){if(e.cookie(t)!==undefined){e.cookie(t,"",e.extend({},n,{expires:-1}));return true}return false}});(function(e){function t(e){var t="";e=e+" ";t=e.replace(/\s+/g,"");return t}function n(e){e+="";e=(new Array(4-e.length%3)).join("U")+e;return e.replace(/([0-9U]{3})/g,"$1 ").replace(/U/g,"")}e.fn.tablePrice=function(r){function b(e,t){if(e.keyCode==46||e.keyCode==8||e.keyCode==9||e.keyCode==27||e.keyCode==65&&e.ctrlKey===true||e.keyCode>=35&&e.keyCode<=39){if(t.val()>9999){t.val(9999);return false}else if(t.val()<1){t.val(1);return false}}else{if(!/^[0-9]*$/.test(t.val())){e.preventDefault()}else{if(t.val()>9999){t.val(9999);return false}else if(t.val()<1){t.val(1);return false}}}}function E(){o.addClass(i.tableClass);if(r.wrapTable){o.find("thead").addClass(i.theadClass);o.find("tbody").addClass(i.tbodyClass);o.find("tfoot").addClass(i.tfootClass);o.wrap('<div class="'+i.tableWrapper+'" />');e(r.totalSelector).parent().wrap('<div class="'+i.totalWrapper+'" />')}}function S(){o.removeClass(i.tableClass);if(r.wrapTable){o.find("thead").removeClass(i.theadClass);o.find("tbody").removeClass(i.tbodyClass);o.find("tfoot").removeClass(i.tfootClass);o.unwrap();e(r.totalSelector).parent().unwrap()}}var i=e.extend({tableWrapper:"tp-wrapper",totalWrapper:"tp-total",tableClass:"tp-table",theadClass:"tp-thead",tbodyClass:"tp-tbody",tfootClass:"tp-tfoot"},i);var r=e.extend({init:true,wrapTable:true,forEach:"tbody tr",space:false,cookie:false,type:"integer",floatFixed:2,spinner:".spinner",inputChange:true,initCost:".tp-default-price",amount:".tp-product-amount",dataAttr:null,totalSelector:"#total-cost",pennySelector:null,totalPenny:null,devider:null,deleteSelector:"tp-delete",deleteDuraction:300,emptyTPL:'<div class="tp-empty-table" style="text-align: center">Корзина пуста</div>',create:function(){},beforeChange:function(){},afterChange:function(){},beforeDelete:function(){},afterDelete:function(){},onTableDel:function(){}},r);if(this.length==0)return this;var s={};var o=e(this);var u=this;var a=o.find(r.forEach);if(this.length>1){this.each(function(){e(this).tablePrice(r)});return this}var f=function(){s.settings=e.extend({},r,i);s.forEach=s.settings.forEach;s.totalSelector=s.settings.totalSelector;s.type=s.settings.type;s.floatFixed=s.settings.floatFixed;s.deleteDuraction=s.settings.deleteDuraction;s.pennySelector=s.settings.pennySelector;s.totalPenny=s.settings.totalPenny;l();if(r.cookie)c();if(r.init)v()};var l=function(){if(!(r.type=="float")){if(r.pennySelector||r.devider)throw new Error("jQuery tablePrice plugIn: Data type does not correct. Set the 'Float' type or disable devider.")}if(r.pennySelector){if(!r.dataAttr)throw new Error("jQuery tablePrice plugIn: Set the dataAttr to get init price of product.")}if(!a.length){w()}};var c=function(){if(r.cookie){var t=o.find(r.spinner);var n=e.cookie("spinnersArray");if(n){n=n.split(",");e.each(t,function(r){if(n){var i=n[r];e(t[r]).val(i)}})}}};var h=function(){if(r.cookie){var t=o.find(r.spinner);var n=new Array;e.each(t,function(r){var i=e(t[r]).val();n.push(i)});e.cookie("spinnersArray",n.join(","))}};var p=function(){if(r.cookie){var t=new Array;t=[1,1,1,1];e.cookie("spinnersArray",t)}};var d=function(){if(r.cookie){var t=e.cookie("spinnersArray");t=t.split(",");return t}};var v=function(){o.each(function(t){newElemBox=e(o[t]).find(r.forEach);s.settings.create(o[t],newElemBox);E();newElemBox.each(function(t,n){var i=e(n);var s=i.find(r.spinner);x(i,s);N();s.on("change",m);s.on("keypress",y);s.on("keyup",g)})})};var m=function(t){if(t.which==32){return false}else{var n=e(this);var i=n.parents(s.forEach);var o=n.val();if(o.length>1&&/^0/.test(o)){var u=new RegExp(/^0*/);o=o.replace(u,"")}if(!o.length)o=1;n.val(o);if(r.inputChange){x(i,n)}}};var g=function(t){var n=e(this);var i=n.parents(s.forEach);b(t,n);var o=n.val();if(t.which==32||!/^[0-9]*$/.test(o)){o=o.replace(/\s/,"").replace(/\D/,"");if(!o.length){o=1}n.val(o)}else if(t.which==37||t.which==39){return}s.settings.beforeChange(i,n);if(r.inputChange){x(i,n)}if(r.cookie)h();s.settings.afterChange(i,n)};var y=function(t){var n=e(this);var r=n.parents(s.forEach);b(t,n)};var w=function(){var t=o.parents("."+i.tableWrapper);o.remove();var n=e(r.totalSelector).parents("."+i.totalWrapper);e(r.totalSelector).remove();n.remove();var u=r.emptyTPL;t.append(u);s.settings.onTableDel()};var x=function(e,i){var s=e.find(r.initCost);if(r.dataAttr){var u=s.data(r.dataAttr)}else{if(r.pennySelector){if(r.type=="float"){var u=s.html();var a=e.find(r.pennySelector);var f=a.html();if(r.devider.length){u=parseInt(u).toString()+r.devider+f}else{u=parseFloat(parseInt(u).toString()+"."+f)}}}else{var u=s.html()}if(r.space){u=t(u)}if(r.devider){var l=new RegExp(r.devider,"g");u=u.replace(l,".")}}var c=e.find(r.amount);var h=i.val();if(r.type=="integer"){u=parseInt(u)}else if(r.type=="float"){if(r.devider){var l=new RegExp(r.devider,"g");u=u.replace(l,".")}var u=parseFloat(u)}var p=u*h;if(r.type=="integer"){if(r.space){p=n(p)}}else if(r.type=="float"){p=p.toFixed(r.floatFixed);if(r.space){p=n(p);if(r.devider){p=p.replace(" .",r.devider)}else{p=p.replace(" .",".")}}else{if(r.devider){p=p.replace(".",r.devider)}else{p=p.replace(".",".")}}}if(r.pennySelector){if(r.type=="float"){var d=e.find(r.pennySelector);if(r.devider){priceArray=p.split(r.devider)}else{priceArray=p.split(".")}p=priceArray[0];var v=priceArray[1];c.html(p);d.html(v)}}else{c.html(p)}var m=o.find(r.forEach);T(m)};var T=function(i){var o=0;var u=0;for(u;u<i.length;u++){if(r.pennySelector){var a=e(i[u]).find(r.pennySelector).html();var f=e(i[u]).find(r.amount).html();if(r.devider){var l=f+r.devider+a}else{var l=f+"."+a}}else{var l=e(i[u]).find(r.amount).html()}if(r.type=="integer"){if(r.devider){var c=new RegExp(r.devider,"g");l=l.replace(c,".")}if(r.space){l=t(l)}var l=parseInt(l)}else if(r.type=="float"){if(r.devider){var c=new RegExp(r.devider,"g");l=l.replace(c,".")}if(r.space){l=t(l)}var l=parseFloat(l)}o+=l}s.totalprice=o;if(r.type=="float"){o=o.toFixed(r.floatFixed)}if(r.devider&&r.type=="float"){o=o.replace(".",r.devider)}if(r.space){o=n(o);if(r.devider&&!r.pennySelector){o=o.replace(" "+r.devider,r.devider)}else{o=o.replace(" .",".")}}if(r.pennySelector){if(r.devider){var h=o.split(r.devider)}else{var h=o.split(".")}var o=h[0];var p=h[1];e(r.totalSelector).html(o);e(r.totalPenny).html(p)}else{e(r.totalSelector).html(o)}};var N=function(){var t=o.find("."+r.deleteSelector);var n=o.find(r.spinner);t.on("click",function(t){var n=e(this).parents(s.forEach);var i=n.index();var u=n.prev();var a=n.next();n.fadeOut(r.deleteDuraction,function(){s.settings.beforeDelete(n,u,a);n.remove();var t=o.find(r.forEach);if(t.length){t.each(function(t,n){var i=e(n);var s=i.find(r.spinner);x(i,s)});s.settings.afterDelete()}else{o.fadeOut(r.deleteDuraction,function(){w()})}});t.preventDefault()})};u.getTotalPrice=function(){return s.totalprice};u.getSpinners=function(){var t=new Array;spinnersArray=o.find(r.spinner).toArray();e.each(spinnersArray,function(n){var r=e(spinnersArray[n]).val();t.push(r)});return t};u.getCookie=d;u.update=function(){a.each(function(t,n){var i=e(n);var s=i.find(r.spinner);x(i,s)})};u.init=v;u.destroy=function(){e.each(a,function(t){var n=e(a[t]).find(r.amount);var i=e(a[t]).find(r.pennySelector);var s=e(r.totalSelector);var o=e(r.totalPenny);var u=e(a[t]).find("."+r.deleteSelector);u.unbind("click");n.html("");i.html("");s.html("");o.html("")});S()};u.updateCookie=h;u.deleteCookie=p;u.setCookie=c;u.getWidget=function(){return s};f();return this}})(jQuery);